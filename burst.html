<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
    <head>
        <title>ANZ Champions</title>
    </head>
    <script src="http://d3js.org/d3.v3.js"></script>
    <script src="underscore.js" charset="utf-8"></script>
    <script src="moment.js" charset="utf-8"></script>
    <script src="papaparse.js" charset="utf-8"></script>
    <script src="jsdata/alldata.js" charset="utf-8"></script>
    <script src="util.js" charset="utf-8"></script>
    <script>
    
window.focusTeam = Util.Teams.Swifts;
window.focusTeamId = window.focusTeam.id;
    
function setupAllData() {
    var teams = {};
    var everySingleMatch = []; 
    window.nodes = [];
    
    for (var i = 2008; i <= 2013; i++) {
        everySingleMatch = everySingleMatch.concat(Util.allMatches[i]);
    }    
    window.everyMatch = everySingleMatch;
    console.log("Every match", everySingleMatch[0]);
    
    
    for(var team in Util.Teams) { 
      if (Util.Teams.hasOwnProperty(team)) {
        console.log("Let's look at ", Util.Teams[team]);
        var focusWins = 0;
        var focusLosses = 0;
        
        
        if (Util.Teams[team].id != window.focusTeamId) {
            var matchesAgainstFocus = everySingleMatch.filter(function(m) {
                return (m.homeTeam.id == Util.Teams[team].id && m.awayTeam.id == window.focusTeamId) || 
                    (m.awayTeam.id == Util.Teams[team].id && m.homeTeam.id == window.focusTeamId);
            });
           
            
            matchesAgainstFocus = matchesAgainstFocus.filter(function (m) {return m.winner() != undefined});
            
            focusWins = matchesAgainstFocus.filter(function (m) {
                    return m.winner().id == window.focusTeamId 
                }).length;
            focusLosses = matchesAgainstFocus.filter(function (m) {return m.winner().id != window.focusTeamId }).length;
            
            var node = {name : Util.Teams[team].name , children : [{name : "wins", size : focusWins}, {name : "losses", size : focusLosses}] };
            
            
            nodes.push(node);
         }
      }
    }
}
window.onload = function() {    
setupAllData();
var root = {name : window.focusTeam.name, children : window.nodes};
window.root = root;
console.log(root);
var width = 960,
    height = 700,
    radius = Math.min(width, height) / 2,
    color = d3.scale.category20c();

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height * .52 + ")");

var partition = d3.layout.partition()
    .sort(null)
    .size([2 * Math.PI, radius * radius])
    .value(function(d) { return 1; });

var arc = d3.svg.arc()
    .startAngle(function(d) { return d.x; })
    .endAngle(function(d) { return d.x + d.dx; })
    .innerRadius(function(d) { return Math.sqrt(d.y); })
    .outerRadius(function(d) { return Math.sqrt(d.y + d.dy); });

console.log("Starting...", partition.nodes);
      var path = svg.datum(root).selectAll("path")
          .data(partition.nodes)
        .enter().append("path")
          .attr("display", function(d) { return d.depth ? null : "none"; }) // hide inner ring
          .attr("d", arc)
          .style("stroke", "#fff")
          .style("fill", function(d) { return color((d.children ? d : d.parent).name); })
          .style("fill-rule", "evenodd")
          .each(stash);

      d3.selectAll("input").on("change", function change() {
        var value = this.value === "count"
            ? function() { return 1; }
            : function(d) { return d.size; };

        path
            .data(partition.value(value).nodes)
          .transition()
            .duration(1500)
            .attrTween("d", arcTween);
      });
    
// Stash the old values for transition.
function stash(d) {
  d.x0 = d.x;
  d.dx0 = d.dx;
}

// Interpolate the arcs in data space.
function arcTween(a) {
  var i = d3.interpolate({x: a.x0, dx: a.dx0}, a);
  return function(t) {
    var b = i(t);
    a.x0 = b.x;
    a.dx0 = b.dx;
    return arc(b);
  };
}
d3.select(self.frameElement).style("height", height + "px");
}
         
    </script>
    <style>

    body {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      margin: auto;
      position: relative;
      width: 960px;
    }

    form {
      position: absolute;
      right: 10px;
      top: 10px;
}
</style>
<form>
  <label><input type="radio" name="mode" value="size"> Size</label>
  <label><input type="radio" name="mode" value="count" checked> Count</label>
</form>
    <body>
    </body>
</html>
